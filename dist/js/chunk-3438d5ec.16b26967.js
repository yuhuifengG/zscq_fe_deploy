(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-3438d5ec"],{"1c89":function(e,t,a){},4740:function(e,t,a){"use strict";a.r(t);var n=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("a-card",{style:{height:"100%"},attrs:{bordered:!1}},[a("div",{staticClass:"table-page-search-wrapper"},[a("a-form",{attrs:{layout:"inline"}},[a("a-row",{attrs:{gutter:48}},[a("a-col",{attrs:{md:6,sm:24}},[a("a-form-item",{attrs:{label:"计划类型："}},[a("a-input",{attrs:{placeholder:"请输入计划类型"},model:{value:e.planTypeName,callback:function(t){e.planTypeName=t},expression:"planTypeName"}})],1)],1),a("a-col",{attrs:{md:6,sm:24}},[a("a-form-item",{attrs:{label:"课题类别："}},[a("a-input",{attrs:{placeholder:"请输入课题类别"},model:{value:e.subjectTypeName,callback:function(t){e.subjectTypeName=t},expression:"subjectTypeName"}})],1)],1),a("a-col",{attrs:{md:6,sm:24}},[a("a-form-item",{attrs:{label:"创建机构"}},[a("a-input",{attrs:{placeholder:"请输入创建机构"},model:{value:e.createdUnitName,callback:function(t){e.createdUnitName=t},expression:"createdUnitName"}})],1)],1),a("a-col",{attrs:{md:6,sm:24}},[a("a-button",{attrs:{type:"primary"},on:{click:e.getAllData}},[e._v("查询")])],1)],1),a("a-button",{directives:[{name:"action",rawName:"v-action:scientific_ade",arg:"scientific_ade"}],staticStyle:{"margin-left":"8px"},attrs:{type:"primary",icon:"plus"},on:{click:function(t){return e.$refs.createNew.add()}}},[e._v("新建")])],1)],1),a("div",{staticClass:"table-operator"}),a("s-table",{ref:"table",attrs:{columns:e.columns,order:"true",data:e.loadData,rowKey:"id"},scopedSlots:e._u([{key:"processModuleCopy",fn:function(t,n){return a("span",{},e._l(t,(function(t){return a("a-tag",{key:t.id,attrs:{color:"blue"},on:{click:function(a){return e.goLx(t,n)}}},[e._v(" "+e._s(t.name)+" ")])})),1)}},{key:"action",fn:function(t,n){return a("span",{},[a("a",{directives:[{name:"action",rawName:"v-action:scientific_ade",arg:"scientific_ade"}],on:{click:function(t){return e.edit(n)}}},[e._v("修改")]),a("a-divider",{attrs:{type:"vertical"}}),a("a",{directives:[{name:"debounce",rawName:"v-debounce",value:function(){e.handleDelete(n)},expression:"()=>{handleDelete(record)}"},{name:"action",rawName:"v-action:scientific_ade",arg:"scientific_ade"}],staticClass:"adanger"},[e._v("删除")])],1)}}])}),a("add-scientific",{ref:"createNew",on:{childFn:e.parentFn}})],1)},i=[],r=(a("4160"),a("159b"),a("96cf"),a("1da1")),s=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("a-modal",{attrs:{width:960,visible:e.visible,confirmLoading:e.confirmLoading,maskClosable:!1,destroyOnClose:!0,footer:null},on:{cancel:e.handleCancel}},[a("a-spin",{attrs:{spinning:e.confirmLoading}},[a("a-form",{attrs:{colon:!1,form:e.form}},[a("a-card",{attrs:{title:"新增科研计划",bordered:!1}},[a("a-row",{attrs:{gutter:24}},[a("a-col",{attrs:{md:8,sm:24}},[a("a-form-item",{attrs:{label:"计划类型"}},[a("a-select",{directives:[{name:"decorator",rawName:"v-decorator",value:["planTypeName",{rules:[{required:!0,message:"请选择计划类型！"}]}],expression:"['planTypeName', {rules: [{required: true, message: '请选择计划类型！'}]}]"}],staticStyle:{width:"100%"},attrs:{labelInValue:"",placeholder:"请选择计划类型"},on:{change:e.planChange}},e._l(e.planTypeNameAll,(function(t){return a("a-select-option",{key:t.id},[e._v(" "+e._s(t.name)+" ")])})),1)],1)],1),a("a-col",{attrs:{md:8,sm:24}},[a("a-form-item",{attrs:{label:"课题类别"}},[a("a-select",{directives:[{name:"decorator",rawName:"v-decorator",value:["subjectTypeName",{rules:[{required:!0,message:"请选择课题类别"}]}],expression:"['subjectTypeName', {rules: [{required: true, message: '请选择课题类别'}]}]"}],staticStyle:{width:"100%"},attrs:{labelInValue:"",placeholder:"请选择课题类别"}},e._l(e.subjectTypeAll,(function(t){return a("a-select-option",{key:t.id},[e._v(" "+e._s(t.name)+" ")])})),1)],1)],1),a("a-col",{attrs:{md:8,sm:24}},[a("a-form-item",{attrs:{label:"是否有子课题"}},[a("a-switch",{attrs:{checked:0!=this.showValid},on:{change:e.onChange2}})],1)],1)],1),a("a-row",{attrs:{gutter:24}},[a("a-col",{attrs:{md:16,sm:24}},[a("a-form-item",{attrs:{label:"流程模块"}},[a("a-select",{directives:[{name:"decorator",rawName:"v-decorator",value:["selectData",{rules:[{required:!0,message:"请选择流程模块"}]}],expression:"['selectData', {rules: [{required: true, message: '请选择流程模块'}]}]"}],staticStyle:{width:"100%"},attrs:{labelInValue:"",placeholder:"请选择流程模块",mode:"multiple"},on:{change:e.handleChange}},e._l(e.processModuleAll,(function(t){return a("a-select-option",{key:t.id,attrs:{disabled:e.hasSubmit(t)}},[e._v(" "+e._s(t.name)+" ")])})),1)],1),e.selectFlag?a("p",{staticStyle:{color:"#f5222d","margin-top":"-10px"}},[e._v("请选择流程模块")]):e._e()],1),a("a-col",{attrs:{md:8,sm:24}},[a("a-form-item",{attrs:{label:"组织机构"}},[a("a-input",{directives:[{name:"decorator",rawName:"v-decorator",value:["createdUnitName",{rules:[{required:!0,message:"请选择组织机构"}]}],expression:"['createdUnitName', {rules: [{required: true, message: '请选择组织机构'}]}]"}],attrs:{placeholder:"请选择组织机构"},on:{click:function(t){return e.selectAll()}}})],1)],1)],1)],1),a("a-row",[a("a-col",{attrs:{span:24,align:"center"}},[a("a-button",{directives:[{name:"debounce",rawName:"v-debounce",value:e.handleSubmit,expression:"handleSubmit"}],attrs:{type:"primary"}},[e._v("保存")]),a("a-button",{staticStyle:{"margin-left":"20px"},on:{click:e.handleCancel}},[e._v("取消")])],1)],1)],1)],1),a("dept-list",{ref:"selectDept",on:{childFn:e.parentFn}})],1)},c=[],l=(a("4de4"),a("a434"),a("b0c0"),a("b64b"),a("8593")),o=a("e56e"),d=a("62c9"),u=a("2ef0"),p=(a("7ded"),{name:"AddScientific",components:{DeptList:d["a"]},data:function(){return{mode:"add",visible:!1,confirmLoading:!1,form:this.$form.createForm(this,{}),createdUnitId:"",showValid:!1,subSystemId:"",selectFlag:!1,planTypeNameAll:[],subjectTypeAll:[],processModuleAll:[{id:"apply",name:"立项模块"},{id:"contract",name:"合同(任务书)模块"},{id:"process",name:"执行模块"},{id:"alter",name:"变更模块"},{id:"acceptance",name:"验收模块"}]}},computed:{},mounted:function(){var e=this;Object(o["i"])("8").then((function(t){e.planTypeNameAll=t.data}))},methods:{hasSubmit:function(e){var t,a="apply"===e.id||"contract"===e.id;return a=a||(null===(t=this.form.getFieldValue("selectData"))||void 0===t?void 0:t.filter((function(e){return"contract"===e.key})).length),!a},handleChange:function(e){if(this.selectFlag=!1,!e.filter((function(e){return"contract"===e.key})).length){var t=Object(u["cloneDeep"])(e.filter((function(e){return"apply"===e.key})));t.length?e.splice(0,e.length,t[0]):e.splice(0,e.length)}},parentFn:function(e){this.createdUnitId=e.id[0],this.form.setFieldsValue({createdUnitName:e.name})},selectAll:function(){this.$refs.selectDept.setVisible()},add:function(e,t){var a=this;this.selectFlag=!1,this.visible=!0,"edit"===t?(this.mode="edit",this.loadSce(e.id)):(this.mode="add",Object(l["jb"])().then((function(e){var t=null===e||void 0===e?void 0:e.data;t&&(a.subSystemId=t.systemId,a.createdUnitId=t.id,a.form.setFieldsValue({createdUnitName:t.name}))})))},loadSce:function(e){var t=this;this.confirmLoading=!0;var a=[];this.form.getFieldDecorator("id",{initialValue:"",preserve:!0}),Object(l["qb"])(e).then((function(e){var n=null===e||void 0===e?void 0:e.data;if(n){if(t.subSystemId=n.subSystemId,null!=n.processModule||""!==n.processModule){n.processModule=JSON.parse(n.processModule);for(var i=0;i<n.processModule.length;i++)a.push({key:n.processModule[i].id,label:n.processModule[i].name})}var r={id:n.id,planTypeName:{key:n.planTypeId,label:n.planTypeName},subjectTypeName:{key:n.subjectTypeId,label:n.subjectTypeName},createdUnitName:n.createdUnitName,selectData:a};t.form.setFieldsValue(r)}t.confirmLoading=!1})).catch((function(e){t.$error({title:"查询失败",content:e.message}),t.confirmLoading=!1}))},handleSubmit:function(){var e=this,t=this.form.validateFields;this.confirmLoading=!0,t((function(t,a){if(t)e.$message.warning("页面验证失败，请检查填写是否正确"),e.confirmLoading=!1;else{a.createdUnitId=e.createdUnitId;var n="add"===e.mode?l["f"]:l["B"];if(a.planTypeId=a.planTypeName.key,a.planTypeName=a.planTypeName.label,a.subjectTypeId=a.subjectTypeName.key,a.subjectTypeName=a.subjectTypeName.label,!a.selectData.length)return e.selectFlag=!0,void(e.confirmLoading=!1);for(var i=[],r=0;r<a.selectData.length;r++)i.push({id:a.selectData[r].key,name:a.selectData[r].label});a.processModule=JSON.stringify(i);var s=new FormData;Object.keys(a).forEach((function(e){var t=a[e];s.append(e,t)})),s.append("subSystemId",e.subSystemId),n(s).then((function(t){e.confirmLoading=!1,t.success?(e.$message.success("保存成功"),e.visible=!1,e.$emit("childFn",1)):e.$message.warning(t.msg)})).catch((function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},a=t.message;e.$error({title:"保存失败",content:a}),e.confirmLoading=!1}))}}))},handleCancel:function(){this.visible=!1},onChange2:function(e){this.showValid=e?1:0},planChange:function(e){var t=this;Object(o["e"])("7",e.key).then((function(e){t.subjectTypeAll=e.data,t.form.setFieldsValue({subjectTypeName:void 0})}))}}}),m=p,f=a("2877"),h=Object(f["a"])(m,s,c,!1,null,null,null),b=h.exports,g=a("ab09"),y=[],v={onChange:function(e,t){},onSelect:function(e,t,a){},onSelectAll:function(e,t,a){}},N={name:"UserList",components:{AddScientific:b,STable:g["a"]},data:function(){return{data:y,columns:[{title:"计划类型",align:"center",width:"180px",dataIndex:"planTypeName"},{title:"课题类别",width:"180px",dataIndex:"subjectTypeName"},{title:"流程模块",dataIndex:"processModuleCopy",width:"360px",scopedSlots:{customRender:"processModuleCopy"}},{title:"创建机构",width:"120px",dataIndex:"createdUnitName"},{title:"操作",align:"left",width:"120px",scopedSlots:{customRender:"action"}}],rowSelection:v,planTypeName:"",subjectTypeName:"",createdUnitName:"",urlObj:{apply:"/apply/add-apply",contract:"/contract/addContract",process:"/process/add-apply",alter:"/alter/alteration-config",acceptance:"/acceptance/add-apply"},pagination:{pageNo:1,pageSize:10,total:10}}},methods:{loadData:function(e){var t=this;return Object(r["a"])(regeneratorRuntime.mark((function a(){var n,i,r;return regeneratorRuntime.wrap((function(a){while(1)switch(a.prev=a.next){case 0:return n={pageNum:e.pageNo,pageSize:e.pageSize,planTypeName:t.planTypeName,subjectTypeName:t.subjectTypeName,createdUnitName:t.createdUnitName},a.next=3,Object(l["E"])(n);case 3:return i=a.sent,t.pagination=e,i.data.records.forEach((function(e){e.processModuleCopy=e.processModule?JSON.parse(e.processModule):[]})),r={data:i.data.records,totalCount:i.data.total,pageNo:e.pageNo,pageSize:e.pageSize},a.abrupt("return",r);case 8:case"end":return a.stop()}}),a)})))()},goLx:function(e,t){},getAllData:function(){this.$refs.table.refresh()},handleDelete:function(e){var t=this;Object(l["u"])(e.id).then((function(a){a.success?t.$confirm({title:"警告?",content:a.msg,onOk:function(){Object(l["p"])(e.id).then((function(e){t.$notification.success({message:"成功",description:"删除成功",duration:4}),t.getAllData()}))}}):t.$notification.open({message:a.data,description:"不支持进行删除操作",duration:4,style:{whiteSpace:"pre-wrap"}})}))},parentFn:function(e){this.getAllData()},clearQueryParam:function(){this.queryParam={}},edit:function(e){this.$refs.createNew.add(e,"edit")}}},w=N,T=(a("b1bf"),Object(f["a"])(w,n,i,!1,null,"c065d1e0",null));t["default"]=T.exports},b1bf:function(e,t,a){"use strict";var n=a("1c89"),i=a.n(n);i.a}}]);