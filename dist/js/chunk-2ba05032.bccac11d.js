(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-2ba05032"],{2373:function(e,t,a){"use strict";var r=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("a-modal",{attrs:{title:"过程查看",width:"1030px","after-close":e.clearData},on:{cancel:e.handleCancel,ok:e.handleCancel},model:{value:e.visible,callback:function(t){e.visible=t},expression:"visible"}},[a("a-tabs",{class:{hideTabsNav:e.closeWorkFlow||e.noWorkflow||e.hideworkflow},attrs:{destroyInactiveTabPane:!0},on:{change:e.changeTabs},model:{value:e.activekey,callback:function(t){e.activekey=t},expression:"activekey"}},[a("a-tab-pane",{key:"processView",staticClass:"process_wp",attrs:{tab:"过程查看"}},[e.closeWorkFlow?a("div",{staticClass:"content"},[a("div",{staticClass:"navigate"},[a("a-steps",{attrs:{current:e.progress,labelPlacement:"vertical"}},e._l(e.navigate,(function(t,r){return a("a-step",{key:r,attrs:{title:t.title}},[a("span",{staticClass:"step-item",class:e.progress===r?"step-current":e.progress>r?"step-pre":"step-wait",attrs:{slot:"icon"},slot:"icon"},[a("a-icon",{staticStyle:{color:"#fff"},attrs:{type:e.progress===r?"hourglass":e.progress>r?"check":"ellipsis"}})],1)])})),1)],1)]):e._e(),a("a-timeline",{staticStyle:{"margin-left":"5%","margin-top":"2%",width:"90%"}},e._l(e.processData,(function(t,r){return a("a-timeline-item",{key:r,attrs:{color:0==t.operationResultCode||2==t.operationResultCode?"red":"green"}},[a("a-card",[a("div",[a("span",{class:0==t.operationResultCode||2==t.operationResultCode?"timelineNameRed":"",staticStyle:{"font-weight":"700","font-size":"15px"}},[e._v(" "+e._s(t.stageName)+" ")]),a("a-tag",{staticStyle:{"margin-left":"10px"},attrs:{size:"small",color:e.setColor1(t)}},[e._v(e._s(e.getOperationResult(t)))]),a("span",{staticStyle:{"font-weight":"400","font-size":"12px",opacity:"0.7","margin-left":"60px"}},[e._v(" "+e._s(t.createdTime)+" ")])],1),a("p",{staticClass:"subItem"},[a("span",[a("span",{staticClass:"subItemTitle"},[e._v("审核人: ")]),e._v(e._s(t.createdByName)+" ")])]),t.opinion?a("p",{staticClass:"subItem"},[a("span",{staticClass:"subItemTitle"},[e._v("审核意见: ")]),e._v('"'+e._s(t.opinion)+'" ')]):e._e(),t.annexUrl&&t.annexName?a("a",{staticClass:"timeLineSingle",attrs:{href:"#"},on:{click:function(a){return e.downloadAnnex(t.id,t.annexName)}}},[e._v(e._s(t.annexName))]):e._e()])],1)})),1)],1),a("a-tab-pane",{key:"flowChat",staticClass:"tabPane_workflow",attrs:{tab:"流程图"}},[e.noWorkflow||e.hideworkflow?e._e():a("div",[a("workflow",{staticClass:"workflowWp",attrs:{data:e.workflowData,wkFlowOptions:e.wkFlowOptions}})],1),e.noWorkflow?a("div",{staticStyle:{color:"#a79999","text-align":"center","padding-top":"100px"}},[e._v("暂无工作流")]):e._e()])],1)],1)},i=[],o=(a("4de4"),a("4160"),a("c975"),a("13d5"),a("fb6a"),a("ac1f"),a("5319"),a("159b"),a("2909")),n=(a("96cf"),a("1da1")),s=a("5530"),l=a("19c5"),c=(a("883e"),a("ab09")),p=a("8593"),d=a("f36f"),u=a("ca00"),f=a("cd3f"),g=a.n(f),h=a("2f62"),v={apply:[[{title:"立项生成",id:"created"},{title:"立项填写",id:"write"},{title:"立项上报",id:"report"},{title:"立项审核",id:"approval"}],[{title:"立项生成",id:"created"},{title:"立项填写",id:"write"},{title:"立项上报",id:"report"},{title:"课题形审",id:"formal"},{title:"立项审核",id:"approval"}],[{title:"立项生成",id:"created"},{title:"立项填写",id:"write"},{title:"立项上报",id:"report"}]],contract:[[{title:"合同(任务书)生成",id:"created"},{title:"合同(任务书)填写",id:"write"},{title:"合同(任务书)上报",id:"report"},{title:"合同(任务书)审核",id:"approval"},{title:"确认签订",id:"legal"}],[{title:"合同(任务书)生成",id:"created"},{title:"合同(任务书)填写",id:"write"},{title:"合同(任务书)上报",id:"report"},{title:"合同(任务书)形审",id:"formal"},{title:"合同(任务书)审核",id:"approval"},{title:"确认签订",id:"legal"}]],process:[[{title:"执行生成",id:"created"},{title:"执行填写",id:"write"},{title:"执行上报",id:"report"},{title:"执行审核",id:"approval"}],[{title:"执行生成",id:"created"},{title:"执行填写",id:"write"},{title:"执行上报",id:"report"},{title:"执行形审",id:"formal"},{title:"执行审核",id:"approval"}]],alter:[[{title:"变更填写",id:"write"},{title:"变更上报",id:"report"},{title:"变更审核",id:"approval"},{title:"确认变更",id:"legal"}],[{title:"变更填写",id:"write"},{title:"变更上报",id:"report"},{title:"变更形审",id:"formal"},{title:"变更审核",id:"approval"},{title:"确认变更",id:"legal"}]],acceptance:[[{title:"验收生成",id:"created"},{title:"验收填写",id:"write"},{title:"验收上报",id:"report"},{title:"验收审核",id:"approval"}],[{title:"验收生成",id:"created"},{title:"验收填写",id:"write"},{title:"验收上报",id:"report"},{title:"验收形审",id:"formal"},{title:"验收审核",id:"approval"}]],property:[[{title:"新建",id:"0"},{title:"待审核",id:"1"},{title:"待上报",id:"2"},{title:"待专业处审核",id:"4"},{title:"待成果办审核",id:"7"},{title:"待提交纸件",id:"8"},{title:"待上传受理通知书",id:"9"},{title:"待审核受理通知书",id:"10"},{title:"退回待修改提交官方文档",id:"16"},{title:"待上传证书",id:"16"},{title:"待补正",id:"11"},{title:"补正待审核",id:"12"},{title:"补正待成果办审核",id:"16"},{title:"待领取盖章件",id:"17"},{title:"已完成",id:"5"}]],accLz:[[{title:"验收上报",id:"report"},{title:"验收形审",id:"formal"},{title:"验收审核",id:"approval"}]]},w={issued:"created",no_qualified:"created",qualified:"created",pendingAudit:"write",rejection:"created",pendingCheck:"report",pendingApproval:"formal",adopt:"approval",no_adopt:"approval",pendingLegal:"approval",approvaling:"approval",legalRejection:"created",sign:"approval",signing:"approval",signed:"legal",cancelSign:"approval",proposal:"approval",no_proposal:"approval",confirm:"approval",cancel:"approval",accept:"approval",pendingAccept:"approval",cancelAccept:"approval"},m={components:{workflow:l["a"],sTable:c["a"]},props:{dataList:{type:Array,default:function(){return[]}},originalMark:{type:Boolean,default:!1},applyFormal:{type:Boolean,default:function(){return!1}},stage:{type:String,default:""},transformStage:{type:String,default:""},module:{type:String,default:""},hideworkflow:{type:Boolean,default:!1}},data:function(){return{defaultActiveKey:"processView",activekey:"processView",workflowData:{title:"流程图",node:{}},wkFlowOptions:{actionType:"view"},currentTab:"processView",visible:!1,progress:0,navigate:[],processData:[],colorPro:[],noWorkflow:!1,type:{"待审批":"warning","驳回":"danger","拒绝":"danger","通过":"success","同意":"success","撤回":"info","发起人":"info"},processTypeArr:{"待审批":"orange","驳回":"red","拒绝":"red","通过":"green","同意":"green","撤回":"blue","发起人":"blue"},subjectId:""}},watch:{subjectId:{handler:function(e,t){e&&this.getWorkFlowId(e)},immediate:!0}},created:function(){},computed:Object(s["a"])({},Object(h["c"])(["isWorkflow"]),{closeWorkFlow:function(){var e=!0;return this.isWorkflow&&Object.prototype.hasOwnProperty.call(this.isWorkflow,this.module+"State")?e=this.isWorkflow[this.module+"State"]:"accLz"==this.module&&(e=this.isWorkflow["acceptanceState"]),e}}),methods:{changeTabs:function(e){this.currentTab=e},show:function(e,t,a,r){switch("apply"===this.module&&r&&r.duplicateId?this.subjectId=r.duplicateId:this.subjectId=e,this.module){case"apply":this.navigate=v.apply[t],this.renderApplyOperationRecord(e);break;case"contract":this.navigate=v.contract[t],this.renderContractOperationRecord(e);break;case"process":this.navigate=v.process[t],this.renderProcessOperationRecord(e);break;case"alter":this.navigate=v.alter[t],this.renderAlterOperationRecord(e);break;case"acceptance":this.navigate=v.acceptance[t],this.renderAcceptanceOperationRecord(e);break;case"property":this.navigate=v.property[t],this.renderPropertyOperationRecord(e);break;case"accLz":this.navigate=v.accLz[t],this.renderAccLzOperationRecord(e);break}},renderApplyOperationRecord:function(e){var t=this;if(this.originalMark||this.applyFormal){var a=this.originalMark?p["hb"]:p["gb"];a(e).then((function(e){var a=w[t.transformStage],r=t.arrIndexNoStage(t.navigate,a,"id");t.handleNavigate(r),t.processData=e.data;for(var i=0;i<e.data.length;i++)i===e.data.length-1?t.colorPro.push("blue"):t.colorPro.push("gray");t.visible=!0,t.workflowHandle()}))}else Object(p["fb"])(e).then((function(e){var a=w[t.transformStage],r=t.arrIndexNoStage(t.navigate,a,"id");t.handleNavigate(r),t.applyFormal||(t.navigate=v.apply[2],"created"!==a&&"write"!==a&&"report"!==a&&(t.progress=v.apply[2].length),e.data=e.data.filter((function(e){return"1"!==e.operationResultCode||"formal"!==e.stageId&&"approval"!==e.stageId}))),t.processData=e.data;for(var i=0;i<e.data.length;i++)i===e.data.length-1?t.colorPro.push("blue"):t.colorPro.push("gray");t.visible=!0,t.workflowHandle()}))},renderApplyOperationRecordWorkFlow:function(e,t){var a=this;return Object(n["a"])(regeneratorRuntime.mark((function r(){var i,n,s,l,c,p;return regeneratorRuntime.wrap((function(r){while(1)switch(r.prev=r.next){case 0:return r.prev=0,r.next=3,Object(d["f"])({dataID:e,deptID:t});case 3:if(i=r.sent,i.length>0){for(n=a.stage,s=a.arrIndex(a.navigate,n,"id"),a.handleNavigate(s),l=g()(i[0].listTaskMessages),c=[],l.forEach((function(e,t){c.push.apply(c,Object(o["a"])(a.filterArr(e)))})),c.reverse(),a.processData=c,p=0;p<a.processData.length;p++)p===a.processData.length-1?a.colorPro.push("blue"):a.colorPro.push("gray");a.visible=!0}else a.noWorkflow=!0,a.$notification.warning({message:"提示",description:"暂无数据"});r.next=9;break;case 7:r.prev=7,r.t0=r["catch"](0);case 9:case"end":return r.stop()}}),r,null,[[0,7]])})))()},renderContractOperationRecord:function(e){var t=this;Object(p["fb"])(e).then((function(e){var a;if(t.transformStage&&w[t.transformStage]){var r=w[t.transformStage];a=t.arrIndexNoStage(t.navigate,r,"id")}else a=t.arrIndex(t.navigate,t.stage,"id");t.handleNavigate(a),t.processData=e.data;for(var i=0;i<e.data.length;i++)i===e.data.length-1?t.colorPro.push("blue"):t.colorPro.push("gray");t.visible=!0,t.workflowHandle()}))},renderProcessOperationRecord:function(e){this.renderCommonOperationRecord(e)},renderAlterOperationRecord:function(e){this.renderCommonOperationRecord(e)},renderAcceptanceOperationRecord:function(e){this.renderCommonOperationRecord(e)},renderAccLzOperationRecord:function(e){this.renderCommonOperationRecord(e)},renderPropertyOperationRecord:function(e){this.renderCommonOperationRecord(e)},renderCommonOperationRecord:function(e){var t=this;Object(p["fb"])(e).then((function(e){var a=w[t.transformStage],r=t.arrIndexNoStage(t.navigate,a,"id");t.handleNavigate(r),t.processData=e.data;for(var i=0;i<e.data.length;i++)i===e.data.length-1?t.colorPro.push("blue"):t.colorPro.push("gray");t.visible=!0,t.workflowHandle()}))},arrIndexNoStage:function(e,t){for(var a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"id",r=0;r<e.length;r++)if(e[r][a]===t)return r+1;if("formal"===t)for(var i=0;i<e.length;i++)if("report"===e[i][a])return i+1},arrIndex:function(e,t){for(var a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"id",r=0;r<e.length;r++)if(e[r][a]===t)return this.stage?r:r+1;if("formal"===t)for(var i=0;i<e.length;i++)if("report"===e[i][a])return this.stage?i:i+1},handleCancel:function(){this.visible=!1,this.workflowData.node={},this.noWorkflow=!1,this.currentTab="processView",this.activekey="processView",this.colorPro=[]},handleNavigate:function(e){this.progress=e||0},downloadAnnex:function(e,t){if(e&&t)try{Object(p["A"])(e).then((function(e){Object.prototype.hasOwnProperty.call(e,"success")||Object(u["b"])(e,t)}))}catch(a){}},getWorkFlowId:function(e){var t=this;return Object(n["a"])(regeneratorRuntime.mark((function a(){var r;return regeneratorRuntime.wrap((function(a){while(1)switch(a.prev=a.next){case 0:return a.prev=0,a.next=3,Object(d["l"])({id:e});case 3:r=a.sent,r.success?(t.noWorkflow=!1,t.getResourcesWorkflow(r.data.id)):t.noWorkflow=!0,a.next=9;break;case 7:a.prev=7,a.t0=a["catch"](0);case 9:case"end":return a.stop()}}),a,null,[[0,7]])})))()},getResourcesWorkflow:function(e){var t=this;return Object(n["a"])(regeneratorRuntime.mark((function a(){var r,i;return regeneratorRuntime.wrap((function(a){while(1)switch(a.prev=a.next){case 0:return a.prev=0,a.next=3,Object(d["h"])({model_id:e});case 3:r=a.sent,1e4===r.code?(i=JSON.parse(r.data.resource),t.workflowData.node=i):20005===r.code&&t.$notification.warning({message:"提示",description:"没有查询到工作流"}),a.next=9;break;case 7:a.prev=7,a.t0=a["catch"](0);case 9:case"end":return a.stop()}}),a,null,[[0,7]])})))()},setColor:function(e){return this.processTypeArr[e]},setColor1:function(e){var t="";return"0"===e.operationResultCode||"2"===e.operationResultCode?t="red":"1"===e.operationResultCode?t="green":null===e.operationResultCode&&"撤回审核"===e.operationResult&&(t="blue"),t},filterArr:function(e){var t=[],a=e.taskMessageList;return a.reduce((function(a,r,i,o){if("撤回"===r.result){if(i>a){var n=g()(e),s=g()(e);n.taskMessageList=o.slice(a,i),t.push(n),s.taskMessageList=o.slice(i,i+1),t.push(s)}else{var l=g()(e);l.taskMessageList=o.slice(i,i+1),t.push(l)}return i+1}if(o.length===i+1){var c=g()(e);c.taskMessageList=o.slice(a,i+1),t.push(c)}return a}),0),t},getOperationResult:function(e){if(e.operationResult)return(e.operationResult.indexOf("成功")>-1||e.operationResult.indexOf("通过")>-1)&&!e.operationResultCode&&(e.operationResultCode="1"),e.operationResult;var t="";return t="0"===e.operationResultCode?"驳回":"1"===e.operationResultCode?"通过":"",t},clearData:function(){this.subjectId=""},workflowHandle:function(){var e=this;this.isWorkflow[this.module+"State"]||this.processData.forEach((function(t){"apply"!=e.module&&"alter"!=e.module&&"acceptance"!=e.module&&"accLz"!=e.module||(t.stageName=t.stageName.replace("审核","确认")),"contract"==e.module&&(t.stageName=t.stageName.replace("审核","签订")),"process"==e.module&&(t.stageName=t.stageName.replace("审核","汇总")),t.stageName=t.stageName.replace("形审","审核"),t.operationResult=t.operationResult?t.operationResult.replace("形审","审核"):null}))}}},b=m,k=(a("94b4"),a("2877")),y=Object(k["a"])(b,r,i,!1,null,"7193b37b",null);t["a"]=y.exports},"94b4":function(e,t,a){"use strict";var r=a("9e95"),i=a.n(r);i.a},"9e95":function(e,t,a){}}]);