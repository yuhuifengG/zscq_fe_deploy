(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-1d23a297"],{3205:function(e,t,a){},"52bf":function(e,t,a){"use strict";var n=a("3205"),i=a.n(n);i.a},5665:function(e,t,a){},a23d:function(e,t,a){"use strict";var n=a("5665"),i=a.n(n);i.a},d40d:function(e,t,a){"use strict";a.r(t);var n=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("a-card",{style:{height:"100%"},attrs:{bordered:!1}},[a("a-alert",{staticStyle:{marginBottom:"20px"},attrs:{message:"分配角色后,需重新登录获取权限",banner:"",closable:"",type:"info"}}),a("div",{staticClass:"table-page-search-wrapper"},[a("a-form",{attrs:{layout:"inline"}},[a("a-row",{attrs:{gutter:48}},[a("a-col",{attrs:{md:6,sm:24}},[a("a-form-item",{attrs:{label:"用户名："}},[a("a-input",{attrs:{placeholder:"请输入用户名"},model:{value:e.loginName,callback:function(t){e.loginName=t},expression:"loginName"}})],1)],1),a("a-col",{attrs:{md:6,sm:24}},[a("a-form-item",{attrs:{label:"真实姓名："}},[a("a-input",{attrs:{placeholder:"请输入真实姓名"},model:{value:e.realName,callback:function(t){e.realName=t},expression:"realName"}})],1)],1),a("a-col",{attrs:{md:6,sm:24}},[a("a-form-item",{attrs:{label:"组织机构名称"}},[a("a-input",{attrs:{placeholder:"请输入组织机构名称"},model:{value:e.deptName,callback:function(t){e.deptName=t},expression:"deptName"}})],1)],1),a("a-col",{attrs:{md:6,sm:24}},[a("a-button",{attrs:{type:"primary"},on:{click:function(t){return e.search(1)}}},[e._v("查询")])],1)],1),a("a-row",{staticStyle:{display:"flex"},attrs:{gutter:24}},[a("a-col",[a("a-button",{directives:[{name:"action",rawName:"v-action:user_add",arg:"user_add"}],staticStyle:{width:"80px"},attrs:{type:"primary"},on:{click:function(t){return e.$refs.createUser.add()}}},[e._v("新建")])],1),a("a-col",[a("a-button",{staticStyle:{"margin-left":"60px"},attrs:{type:"primary"},on:{click:e.toLead}},[e._v("下载导入模版")])],1),a("a-col",{staticStyle:{"margin-left":"8px"}},[a("a-button",{attrs:{type:"primary"},on:{click:e.mulImport}},[e._v("批量导入")])],1)],1)],1)],1),a("div",{staticClass:"table-operator"}),a("a-table",{attrs:{columns:e.columns,dataSource:e.data,rowKey:"id",scroll:{x:1500},pagination:e.pagination},on:{change:e.pageChange},scopedSlots:e._u([{key:"roleNames",fn:function(t){return a("span",{},e._l(t,(function(t){return a("a-tag",{key:t,attrs:{color:"blue"}},[e._v(e._s(t))])})),1)}},{key:"action",fn:function(t,n){return a("span",{staticStyle:{"word-break":"keep-all"}},[a("a",{directives:[{name:"action",rawName:"v-action:user_ed",arg:"user_ed"}],on:{click:function(t){return e.edit(n)}}},[e._v("修改")]),a("a-divider",{attrs:{type:"vertical"}}),1==n.state&&e.userId!==n.id?a("a",{directives:[{name:"action",rawName:"v-action:user_getRole",arg:"user_getRole"}],on:{click:function(t){return e.handleGetrole(n)}}},[e._v("分配角色")]):e._e(),1==n.state&&e.userId!==n.id?a("a-divider",{attrs:{type:"vertical"}}):e._e(),1==n.state?a("a",{directives:[{name:"action",rawName:"v-action:user_froze",arg:"user_froze"}],on:{click:function(t){return e.handleFrozeUser(n)}}},[e._v("冻结账户")]):e._e(),1==n.state?a("a-divider",{directives:[{name:"action",rawName:"v-action:user_froze",arg:"user_froze"}],attrs:{type:"vertical"}}):e._e(),2==n.state?a("a",{directives:[{name:"action",rawName:"v-action:user_froze",arg:"user_froze"}],on:{click:function(t){return e.handleFrozeUser(n)}}},[e._v("解冻账户")]):e._e(),2==n.state?a("a-divider",{directives:[{name:"action",rawName:"v-action:user_froze",arg:"user_froze"}],attrs:{type:"vertical"}}):e._e(),a("a",{directives:[{name:"debounce",rawName:"v-debounce",value:function(){e.handleDeleteUser(n)},expression:"()=>{handleDeleteUser(record)}"},{name:"action",rawName:"v-action:user_ed",arg:"user_ed"},{name:"show",rawName:"v-show",value:e.userId!==n.id,expression:"userId !== record.id"}],staticClass:"adanger"},[e._v("删除")])],1)}}])}),a("a-modal",{attrs:{centered:"centered","mask-closable":!1,okText:"确认",cancelText:"取消"},on:{ok:e.menAction},model:{value:e.visible,callback:function(t){e.visible=t},expression:"visible"}},[a("div",{attrs:{slot:"title"},slot:"title"},[e._v("分配角色")]),a("a-checkbox-group",{attrs:{options:e.plainOptions,value:e.checkedList},on:{change:e.onChange}})],1),a("add-user",{ref:"createUser",on:{childFn:e.parentFn}}),a("more-user-import",{ref:"moreUser"}),a("a-modal",{attrs:{title:"数据范围",width:"600px"},on:{ok:e.handleDataSubmit,cancel:e.handleDataCancel},model:{value:e.isOn,callback:function(t){e.isOn=t},expression:"isOn"}},[a("a-card",{attrs:{bordered:!1}},[a("a-form",{attrs:{layout:"inline"}},[a("a-row",{attrs:{gutter:16}},[a("a-col",{attrs:{md:24}},[a("a-form-item",{attrs:{label:"清洗范围"}},[a("a-radio-group",{attrs:{options:e.dataRangeList},model:{value:e.remark,callback:function(t){e.remark=t},expression:"remark"}})],1)],1)],1)],1)],1)],1)],1)},i=[],r=(a("a15b"),a("d81d"),a("b0c0"),a("8593")),o=a("2b0e"),s=a("c1df"),c=a.n(s),l=a("55b5f"),d=a("4b90"),u=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("a-modal",{attrs:{title:"请选择组织机构",visible:e.visible,maskClosable:!1,destroyOnClose:!0,footer:null,width:"960px"},on:{cancel:e.handleCancel}},[a("div",{staticClass:"mb20"},[a("a-row",{attrs:{gutter:24}},[a("a-col",{attrs:{md:12}},[a("span",[e._v("选择组织机构：")]),a("a-input",{staticStyle:{width:"300px"},attrs:{placeholder:"请输入组织名称/简称"},on:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.$refs.table.refresh(!0)}},model:{value:e.queryParam.name,callback:function(t){e.$set(e.queryParam,"name",t)},expression:"queryParam.name"}})],1),a("a-col",{attrs:{md:6}},[a("span",{staticClass:"table-page-search-submitButtons",style:e.advanced&&{float:"right",overflow:"hidden"}||{}},[a("a-button",{staticStyle:{width:"80px"},attrs:{type:"primary"},on:{click:e.handleSearch}},[e._v("查询")])],1)])],1)],1),a("s-table",{ref:"table",attrs:{order:"true",size:"default",rowKey:"id",scroll:{x:"desktop"!==e.$store.getters.device&&1600},columns:e.columns,data:e.loadData,expandIconColumnIndex:1,rowSelection:e.rowSelection,expandedRowKeys:e.expandedRowKeys,childrenColumnName:"subData",showPagination:"auto"},on:{expand:e.onExpand}}),a("a-row",[a("a-col",{attrs:{span:24,align:"center"}},[a("input",{ref:"input",staticStyle:{display:"none"},attrs:{type:"file"},on:{change:e.inputChange}}),a("a-button",{directives:[{name:"action",rawName:"v-action:dept_checkFile",arg:"dept_checkFile"}],attrs:{loading:e.confirmLoading,icon:"arrow-down",type:"primary"},on:{click:e.checkFile}},[e._v("选择导入文件")]),a("a-button",{staticStyle:{"margin-left":"20px"},on:{click:e.handleCancel}},[e._v("取消")])],1)],1)],1)},h=[],m=(a("99af"),a("4160"),a("4ec9"),a("b64b"),a("d3b7"),a("3ca3"),a("159b"),a("ddb0"),a("c04c")),p=a.n(m),f={name:"MoreUserImport",data:function(){return{visible:!1,queryParam:{},expandedRowKeys:[],questSubDept:{state:"done",data:null},dataMap:new Map,columns:[{title:"单位名称",width:240,dataIndex:"name"},{title:"独立法人",dataIndex:"unitLegalFlag",width:120,customRender:function(e){return"1"===e?"是":"否"}},{title:"联系人",width:140,dataIndex:"linkPerson"},{title:"联系电话",width:160,dataIndex:"linkTel"},{title:"注册时间",width:140,dataIndex:"createdTime",customRender:function(e){return e?c()(e).format("YYYY-MM-DD"):e}}],selectedRowKeys:[],selectedRows:[],advanced:!1,uploadFile:{name:null},confirmLoading:!1}},methods:{show:function(){this.visible=!0},handleCancel:function(){this.visible=!1,this.confirmLoading=!1,this.uploadFile={name:null}},handleSubmit:function(){},loadData:function(e){var t;this.parameter=e;var a,n=this.questSubDept,i=n.state,r=n.data;"ready"===i?(this.questSubDept.state="doing",t=this.loadSubDept(null!==(a=null===r||void 0===r?void 0:r.id)&&void 0!==a?a:"")):"done"===i?t=this.loadTopDept(e):"search"===i&&(t=this.loadTermDept(e));return t.then((function(e){return e.data=e.data||[],e.totalCount=e.totalCount||0,e.pageNo=e.pageNo||0,e})).catch((function(e){return{data:[],totalCount:1,pageNo:1}}))},loadTopDept:function(e){var t=this;this.dataMap.clear(),this.expandedRowKeys=[];var a=Object.assign({},this.queryParam);return Object(r["db"])(a,e.pageNo,e.pageSize).then((function(e){var a,n=null!==(a=e.data)&&void 0!==a?a:{records:[],pageNo:0,total:0};return t.appendSubProp(n.records),{data:n.records,totalCount:n.total,pageNo:n.current}}))},loadSubDept:function(e){var t=this,a=this.$refs.table,n=a.localDataSource,i=a.localPagination;return Object(r["ib"])(e).then((function(a){var r,o=t.dataMap.get(e);o&&(t.appendSubProp(a.data),o.subData=null!==(r=a.data)&&void 0!==r?r:[],o.__loaded=!0);return{data:n,totalCount:i.total,pageNo:i.current}})).then((function(e){return t.questSubDept.state="done",t.questSubDept.data=null,e})).catch((function(e){t.$notification.error({message:"查询失败",description:e.message})}))},loadTermDept:function(e){var t=this;this.dataMap.clear(),this.expandedRowKeys=[];var a=Object.assign({},this.queryParam);return Object(r["eb"])(a,e.pageNo,e.pageSize).then((function(e){return t.questSubDept.data=null,{data:e.data.records,totalCount:e.data.total,pageNo:e.data.current}}))},handleSearch:function(){for(var e in this.queryParam)this.queryParam[e]||0===this.queryParam[e]||delete this.queryParam[e];this.questSubDept.state=Object.keys(this.queryParam).length?"search":"done",this.$refs.table.refresh()},onSelectChange:function(e,t){this.selectedRowKeys=e,this.selectedRows=t},handleClear:function(){for(var e in this.queryParam)delete this.queryParam[e];this.questSubDept.state="done",this.$refs.table.refresh()},onExpand:function(e,t){if(e){if(this.expandedRowKeys.push(t.id),!0===t.__loaded)return;this.questSubDept.state="ready",this.questSubDept.data=t,this.$refs.table.refresh()}else p()(this.expandedRowKeys,(function(e){return e===t.id})),this.expandedRowKeys=[].concat(this.expandedRowKeys)},appendSubProp:function(e){var t=this;e&&e.length&&e.forEach((function(e){var a;t.dataMap.set(e.id,e),(null===(a=e.subDeptList)||void 0===a?void 0:a.length)&&(e.subData=[])}))},checkFile:function(){1===this.rowSelection.selectedRowKeys.length?this.$refs.input.click():this.$message.info("需要选择且只能选择一个导入组织机构")},inputChange:function(e){var t=this;if(e.target.files[0]){this.confirmLoading=!0,this.uploadFile=e.target.files[0];var a=new FormData;a.append("multipartFile",this.uploadFile),a.append("deptId",this.rowSelection.selectedRowKeys[0]),Object(r["Y"])(a).then((function(e){e.success?(t.confirmLoading=!1,t.visible=!1,t.$notification.success({message:"成功",description:e.msg}),t.refreshItem(t.rowSelection.selectedRowKeys[0],"addSub")):(t.$notification.error({message:"失败",description:e.msg}),t.visible=!1,t.confirmLoading=!1,t.uploadFile={name:null})}))}}},computed:{rowSelection:function(){return{selectedRowKeys:this.selectedRowKeys,onChange:this.onSelectChange,type:"radio"}}}},g=f,b=(a("52bf"),a("2877")),v=Object(b["a"])(g,u,h,!1,null,"6b6b1b33",null),w=v.exports,y=a("ac0d"),k=[],S={onChange:function(e,t){},onSelect:function(e,t,a){},onSelectAll:function(e,t,a){}},x={name:"UserList",mixins:[y["c"]],components:{AddUser:l["a"],moreUserImport:w},data:function(){var e=this;return{data:k,columns:[{title:"序号",width:60,align:"center",customRender:function(t,a,n){return(e.pagination.current-1)*e.pagination.pageSize+(n+1)}},{title:"操作",align:"left",width:200,scopedSlots:{customRender:"action"}},{title:"用户名",width:160,dataIndex:"loginName"},{title:"真实姓名",width:150,dataIndex:"realName"},{title:"手机号码",width:150,dataIndex:"mobileNumber",key:"mobileNumber"},{title:"组织机构",width:160,dataIndex:"deptName"},{title:"角色",width:180,dataIndex:"roleNames",key:"roleNames",scopedSlots:{customRender:"roleNames"}},{title:"用户状态",width:80,dataIndex:"state",customRender:function(e){return"1"===e?"正常":"已冻结"}},{title:"最后登录时间",width:140,dataIndex:"lastLoginTime",key:"lastLoginTime",customRender:function(e){return e?c()(e).format("YYYY-MM-DD"):null}}],rowSelection:S,visible:!1,loginName:"",realName:"",deptName:"",checkedList:[],plainOptions:[],rowData:{},checkName:"",pagination:{showSizeChanger:!0,pageSizeOptions:["10","20","30","40"],pageSize:10,current:1,total:100},filterData:{pageSize:1,pageNum:10},userId:"",isOn:!1,dataRangeList:[{label:"全部",value:"0"},{label:"日志",value:"1"},{label:"业务数据",value:"2"},{label:"updatedBy+createdBy",value:"3"}],remark:"0",uploadFile:{name:null}}},methods:{search:function(){this.filterData={loginName:this.loginName,realName:this.realName,deptName:this.deptName},this.pagination.current=1,this.getList()},getList:function(){var e=this;this.filterData.pageSize=this.pagination.pageSize,this.filterData.pageNum=this.pagination.current,Object(r["pb"])(this.filterData).then((function(t){e.data=t.data.records,e.pagination.total=t.data.total}))},pageChange:function(e,t,a,n){n.currentDataSource;this.pagination=e,this.getList()},parentFn:function(e){this.getList()},clearQueryParam:function(){this.queryParam={}},edit:function(e){this.$refs.createUser.add(e,"edit")},handleDeleteUser:function(e){var t=this;this.$confirm({title:"警告?",content:"是否删除该用户",onOk:function(){Object(r["w"])(e.id).then((function(e){t.getList(),t.$notification.warning({message:"成功",description:"删除成功",duration:4})})).catch((function(e){return t.$error({title:"删除失败",content:e.message})}))},onCancel:function(){}})},handleFrozeUser:function(e){var t=this,a="是否解冻用户？";1===+e.state&&(a="是否冻结用户？"),this.$confirm({title:"警告",content:a,onOk:function(){return 1===+e.state?Object(r["D"])("froze",e.id).then((function(){t.$notification.success({message:"冻结成功",duration:4}),t.getList()})).catch((function(e){return t.$error({title:"冻结失败",content:e.message})})):Object(r["D"])("unfroze",e.id).then((function(){t.$notification.success({message:"解冻成功",duration:4}),t.getList()})).catch((function(e){return t.$error({title:"解冻成功",content:e.message})}))}})},handleResetPwd:function(e){var t=this;this.$confirm({title:"警告",content:"是否重置密码？",onOk:function(){return Object(r["lb"])(e.id).then((function(e){t.$confirm({title:"重置成功",content:e.msg,okText:"确定",cancelText:"取消"})})).catch((function(e){return t.$error({title:"重置失败",content:e.message})}))}})},onChange:function(e){this.checkedList=e},handleGetrole:function(e){var t=this;this.visible=!0,this.plainOptions=[],this.checkedList=[],this.rowData=e,this.checkName=e.roleNames,Object(r["P"])(e.id).then((function(e){for(var a=0;a<e.data.length;a++)t.checkedList.push(e.data[a].id)})),Object(r["Q"])("").then((function(e){for(var a=0;a<e.data.length;a++)t.plainOptions.push({label:e.data[a].name,value:e.data[a].id})}))},menAction:function(){var e=this,t={userId:this.rowData.id,roleId:this.checkedList.join(","),optionRoleId:this.plainOptions.map((function(e){return e.value})).join(",")};Object(r["yb"])(t).then((function(t){t.success?(e.$notification.success({message:"授权成功",duration:4}),e.visible=!1,e.getList()):e.$notification.warning({message:t.msg,duration:4})})).catch((function(t){return e.$error({title:"重置失败",content:t.message})}))},toLead:function(){window.open(d["a"]+"/system/userinfo/download-template","_blank")},mulImport:function(){this.$refs.moreUser.show()},dataClean:function(){this.isOn=!0},handleDataCancel:function(){this.isOn=!1},handleDataSubmit:function(){var e=this;Object(r["q"])(this.remark).then((function(t){t.success?(e.$notification.success({message:"操作成功",duration:4}),e.isOn=!1):e.$notification.error({message:"操作失败",duration:4})}))},dataEncrypt:function(){var e=this;Object(r["r"])().then((function(t){t&&t.success?e.$notification.success({message:"加密成功",description:t.msg}):e.$notification.error({message:"加密失败",description:t.msg})}))}},mounted:function(){this.getList(),this.userId=o["a"].ls.get("USER_INFO").id}},N=x,_=(a("a23d"),Object(b["a"])(N,n,i,!1,null,"488ab1ed",null));t["default"]=_.exports}}]);